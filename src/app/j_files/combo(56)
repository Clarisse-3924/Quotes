YUI.add("hermes-template-notif-item-upload",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,i,n){var l,s,p=e.escapeExpression;return'<div class="notification-item notif-item-upload">\n\t<span class="notification-type">NotificationType: '+p("function"==typeof(s=null!=(s=a.type||(null!=t?t.type:t))?s:a.helperMissing)?s.call(null!=t?t:{},{name:"type",hash:{},data:n}):s)+'</span>\n\t<div class="entity-type">ObjectType: '+p(e.lambda(null!=(l=null!=t?t.activityData:t)?l.objectType:l,t))+"</div>\n</div>\n"},useData:!0}),i={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)}),e.Template.register("hermes/notif-item-upload",function(t,n){return n=n||{},n.partials=n.partials?e.merge(i,n.partials):i,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("notifications-helper",function(t,e){var i=require("hermes-core/flog")(e),n=t.mix({langBundles:["common","notifications","relative-dates","profile","photo-card","header"]},t.Localizable),o={fave:"notif-item-fave",comment:"notif-item-comment",reply_reply:"notif-item-reply-reply",group_topic_new:"notif-item-group-topic-new",contacted:"notif-item-contacted",group_invite:"notif-item-group-invite",note:"notif-item-note",tag:"notif-item-tag",people:"notif-item-people",testimonial:"notif-item-testimonial",group_user_invite:"notif-item-group-user-invite",flickrmail:"notif-item-flickrmail",photo_comment_mention:"notif-item-photo-comment-mention",gallery:"notif-item-gallery",gallery_comment:"notif-item-gallery-comment",share:"notif-item-share",photo_accepted:"notif-item-photo-accepted",photo_declined:"notif-item-photo-declined",photo_mention:"notif-item-photo-mention",group_blast:"notif-item-group-blast",upload:"notif-item-upload"},a=50;t.NotificationsHelper=function(e,r){function l(t){var e=t.getSizeToFit({width:a,height:a},{sizes:t.getValue("sizes"),cropToFit:!0,includeSquare:!0});return{id:t.getValue("id"),url:t.getValue("url"),displayUrl:e.displayUrl}}function s(e,i){var n=[],o=[],a=[],r=[],l={},s=[];return e.activityData.users&&(e.activityData.users.forEach(function(t){o.push(m.person.extractEntityModel(t))}),n.push(t.Promise.all(o).then(function(t){return r=t,t}))),Object.keys(m).forEach(function(t){e.activityData[t]&&n.push(m[t].extractEntityModel(e.activityData[t]).then(function(e){return l[t]=e,e}))}),e.eventDataList.forEach(function(e){var i=[],n={};Object.keys(m).forEach(function(t){e[t]&&i.push(m[t].extractEntityModel(e[t]).then(function(e){return n[t]=e,e}))}),a.push(t.Promise.all(i).then(function(){return n}))}),n.push(t.Promise.all(a).then(function(t){return s=t,t})),t.Promise.all(n).then(function(){return{userModels:r,activityEntityModels:l,eventEntityModelsList:s}})}function u(t,e){return t.setValue("isContact",e),t.remoteUpdate().catch(function(e){t.setValue("isContact",!1),i.error({err:e})})}function p(t,e){return t.setValue("isIgnored",e),e&&t.setValue("isContact",!1),t.remoteUpdate().catch(function(e){t.setValue("isContact",!1),i.error({err:e})})}var c,m,g,d=new t.TemplateLibraryHelper(e,{localizeLib:n});m={photo:{extractEntityModel:function(i){return t.FlickrPromise({photoModelRegistry:e.getModelRegistry("photo-models"),personModelRegistry:e.getModelRegistry("person-models"),photoEngagementModelRegistry:e.getModelRegistry("photo-engagement-models"),photoStatsRegistry:e.getModelRegistry("photo-stats-models")}).then(function(e){var n=t.clone(i);if(n.title){var o=n.title.content||n.title._content;n.title=o}return t.APIHelper.response.parsePhotos({photos:[n],photoModelRegistry:e.photoModelRegistry,personModelRegistry:e.personModelRegistry,photoEngagementModelRegistry:e.photoEngagementModelRegistry,photoStatsModelRegistry:e.photoStatsRegistry}).shift()})}},set:{extractEntityModel:function(t){return t}},gallery:{extractEntityModel:function(i){return t.FlickrPromise({galleryModelRegistry:e.getModelRegistry("notification-gallery-models")}).then(function(t){return t.galleryModelRegistry.addOrUpdate(t.galleryModelRegistry.parseGalleryModel(i))})}},person:{extractEntityModel:function(i){return t.FlickrPromise({personModelRegistry:e.getModelRegistry("person-models")}).then(function(e){var n=i;return e.personModelRegistry.addOrUpdate(t.APIHelper.response.parsePerson({nsid:n.user,pathAlias:n.pathAlias,username:n.username,realname:n.realname,isAdFree:n.isAdFree,ispro:n.ispro,proBadge:n.proBadge,datecreate:n.datecreate,iconurls:n.iconurls}))})}},flickrmail:{extractEntityModel:function(i){return t.FlickrPromise({flickrMailModelRegistry:e.getModelRegistry("notification-flickrmail-models")}).then(function(t){return t.flickrMailModelRegistry.addOrUpdate(t.flickrMailModelRegistry.parseFlickrMailModel(i))})}},group:{extractEntityModel:function(i){return t.FlickrPromise({groupModelRegistry:e.getModelRegistry("group-models")}).then(function(t){return t.groupModelRegistry.addOrUpdate(t.groupModelRegistry.parseGroupModel(i.id,i.pathAlias,i))})}},discussion:{extractEntityModel:function(i){return t.FlickrPromise({groupModelRegistry:e.getModelRegistry("group-models"),discussionModelRegistry:e.getModelRegistry("notification-group-discussion-models")}).then(function(e){var n,o;return o=t.clone(i),o.id=i.group_id,o.title=i.group_name,n=e.groupModelRegistry.addOrUpdate(e.groupModelRegistry.parseGroupModel(i.group_id,i.pathAlias,o)),e.discussionModelRegistry.add(e.discussionModelRegistry.parseDiscussionModel(i.id,i.pathAlias,i,n))})}},testimonial:{extractEntityModel:function(t){return t}}},g={person:{loadConfig:function(i){i.item;var n=[];return n.push(g.default.loadConfig(i)),n.push(e.getModel("person-relationship-models",i.personModel.getValue("nsid"))),t.Promise.all(n).then(function(t){return{contextMenuType:"person",item:i.item,personModel:i.personModel,relationshipModel:t[1]}})},getConfig:function(i){var o;return(o=g.default.getConfig(i)).actionList.push({actionId:"sendMessage",text:n.intlMessage({intlName:"photo-card.SEND_A_MESSAGE"}),onSelected:function(e){t.config.win.open(t.URLHelper.generatePersonUrls(i.personModel).sendFlickrMail,"_blank")}}),i.relationshipModel.getValue("isIgnored")||(i.relationshipModel.getValue("isContact")?o.actionList.push({actionId:"unfollowOwner",text:n.intlHTMLMessage({intlName:"photo-card.UNFOLLOW_USER",username:i.personModel.getValue("displayname")}),onSelected:function(t){u(i.relationshipModel,!1)}}):o.actionList.push({actionId:"followOwner",text:n.intlHTMLMessage({intlName:"photo-card.FOLLOW_USER",username:i.personModel.getValue("displayname")}),onSelected:function(t){u(i.relationshipModel,!0)}})),i.relationshipModel.getValue("isIgnored")?o.actionList.push({actionId:"unblockOwner",text:n.intlHTMLMessage({intlName:"photo-card.UNBLOCK_USER",username:i.personModel.getValue("displayname")}),onSelected:function(t){p(i.relationshipModel,!1)}}):o.actionList.push({actionId:"blockOwner",text:n.intlHTMLMessage({intlName:"photo-card.BLOCK_USER",username:i.personModel.getValue("displayname")}),onSelected:function(o){!(function(i,o){var a=new t.Views.FluidModal({appContext:e,title:n.intlHTMLMessage({intlName:"photo-card.BLOCK_USER_QUESTION",username:o}),message:"<p>"+n.intlMessage({intlName:"photo-card.BLOCK_CONFIRM_MESSAGE"})+"</p><p>"+n.intlHTMLMessage({intlName:"photo-card.BLOCK_CONFIRM_MESSAGE_NOTE"})+"</p>",actionButtonIsDangerous:!0,actionButtonLabel:n.intlMessage({intlName:"header.BLOCK"}),overlayClassList:"over-droparound-under-modal"});a.show(),a.on("actionClick",function(){p(i,!0)})})(i.relationshipModel,i.personModel.getValue("displayname"))}}),o}},group:{loadConfig:function(i){i.item;var n=[],o=new t.GroupStatusHelper(e,{groupId:i.groupId});return n.push(g.default.loadConfig(i)),n.push(o.load()),t.Promise.all(n).then(function(t){return{contextMenuType:"group",item:i.item,groupStatusHelper:o}})},getConfig:function(t){var e,i;return e=g.default.getConfig(t),(i=t.groupStatusHelper.getInfo()).joinStatus.canJoin?e.actionList.push({actionId:"joinGroup",text:n.intlMessage({intlName:"photo-card.JOIN_GROUP"}),onSelected:function(e){if(i.groupAttrs.id)return t.groupStatusHelper.initiateJoinGroup()}}):i.groupAttrs.isMember&&e.actionList.push({actionId:"leaveGroup",text:n.intlMessage({intlName:"photo-card.LEAVE_GROUP"}),onSelected:function(e){if(i.groupAttrs.id)return t.groupStatusHelper.initiateLeaveGroup()}}),e}},default:{loadConfig:function(e){return t.Promise.resolve()},getConfig:function(t){var e={actionList:[]};return t.item.activityData.isMuted?e.actionList.push({actionId:"unmuteNotification",text:"TMP Unmute this notification",onSelected:function(t){console.log("unmute!")}}):e.actionList.push({actionId:"muteNotification",text:"TMP Mute this notification",onSelected:function(t){console.log("mute!")}}),e}}},c={fave:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o;if(i.activityData.photo){var a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_FAVED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FAVED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}}var s=i.userModels[0],u=i.eventEntityModelsList.map(function(t){return t.photo});return o=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FAVED_X_PHOTOS",personName:s.getValue("displayname"),personUrl:s.getValue("url"),photoCountString:i.activityData.countEvents,mediaType:u[0].getValue("mediaType")}),{headline:o,timestamp:i.timestamp,avatarData:{id:s.getValue("id"),type:"person",iconUrl:s.getValue("buddyicon").small,url:s.getValue("url")},photos:u.map(function(t){return l(t)}).slice(0,12),hasMultiplePhotos:u.length>1}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},comment:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o;if(i.activityData.photo){var a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_COMMENTED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENTED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),commentUrl:a.getValue("url")+"/#comment"+i.eventDataList[0].commentid,commentContent:t.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}}var s=i.userModels[0],u=i.eventEntityModelsList.map(function(t){return t.photo});return o=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENTED_X_PHOTOS",personName:s.getValue("displayname"),personUrl:s.getValue("url"),photoCountString:i.activityData.countEvents,mediaType:u[0].getValue("mediaType")}),{headline:o,timestamp:i.timestamp,avatarData:{id:s.getValue("id"),type:"person",iconUrl:s.getValue("buddyicon").small,url:s.getValue("url")},photos:u.map(function(t){return l(t)}).slice(0,12),hasMultiplePhotos:u.length>1}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},reply_reply:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o,a=i.activityEntityModels.group,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_REPLIED_TO_TOPIC",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1),topicName:t.StringHelper.stripTags(i.activityData.topic.name),topicUrl:a.getValue("urlDiscussionPage")+"/"+i.activityData.topic.id}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_REPLIED_TO_TOPIC",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),topicName:t.StringHelper.stripTags(i.activityData.topic.name),topicUrl:a.getValue("urlDiscussionPage")+"/"+i.activityData.topic.id,replyContent:t.StringHelper.stripTags(i.eventDataList[0].content),replyUrl:a.getValue("urlDiscussionPage")+"/"+i.activityData.topic.id+"/"+i.eventDataList[0].replyId}),{headline:o,timestamp:i.timestamp,subtitle:a.getValue("title"),subtitleUrl:a.getValue("url"),avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")}}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},group_topic_new:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o,a=i.activityEntityModels.group,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_CREATED_TOPICS",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1),topicsUrl:a.getValue("urlDiscussionPage")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_CREATED_TOPIC",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),topicName:t.StringHelper.stripTags(i.activityData.topic.name),topicUrl:a.getValue("urlDiscussionPage")+"/"+i.activityData.topic.id}),{headline:o,timestamp:i.timestamp,subtitle:a.getValue("title"),subtitleUrl:a.getValue("url"),avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")}}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},contacted:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("follow-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(t){var e,i=t.userModels;return e=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FOLLOWED_YOU",personName:i[0].getValue("displayname"),personUrl:i[0].getValue("url")}),{headline:e,timestamp:t.timestamp,avatarData:{id:i[0].getValue("id"),type:"person",iconUrl:i[0].getValue("buddyicon").small,url:i[0].getValue("url")}}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},group_invite:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("group-invite-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(t){var e,i=t.eventEntityModelsList[0].group,o=t.activityEntityModels.photo,a=t.userModels;return e=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_INVITED_1_PHOTO_TO_GROUP",personName:a[0].getValue("displayname"),personUrl:a[0].getValue("url"),groupName:i.getValue("title"),groupUrl:i.getValue("urlPoolPage")}),{headline:e,timestamp:t.timestamp,subtitle:i.getValue("title"),subtitleUrl:i.getValue("url"),avatarData:{id:a[0].getValue("id"),type:"person",iconUrl:a[0].getValue("buddyicon").small,url:a[0].getValue("url")},photo:l(o)}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},note:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o,a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_LEFT_NOTE_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_LEFT_NOTE_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),noteUrl:a.getValue("url"),noteContent:t.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},tag:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o,a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_TAGGED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_TAGGED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),tagUrl:a.getValue("url"),tagName:t.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},people:{},testimonial:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("testimonial-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(t){var i,o=t.userModels;return i=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_TESTIMONIAL",personName:o[0].getValue("displayname"),personUrl:o[0].getValue("url"),testimonialUrl:"/people/"+e.getViewer().nsid+"/#testimonial"+t.eventDataList[0].id,testimonialContent:"TMP The testimonial content from this notification"}),{headline:i,timestamp:t.timestamp,avatarData:{id:o[0].getValue("id"),type:"person",iconUrl:o[0].getValue("buddyicon").small,url:o[0].getValue("url")}}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},group_user_invite:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("group-user-invite-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(t){var e,i=t.activityEntityModels.group,o=t.userModels;return e=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_INVITED_YOU_TO_GROUP",personName:o[0].getValue("displayname"),personUrl:o[0].getValue("url"),groupName:i.getValue("title"),groupUrl:i.getValue("url")}),{headline:e,timestamp:t.timestamp,subtitle:i.getValue("title"),subtitleUrl:i.getValue("url"),avatarData:{id:o[0].getValue("id"),type:"person",iconUrl:o[0].getValue("buddyicon").small,url:o[0].getValue("url")}}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},flickrmail:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(e){var i,o=e.userModels;return i=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FLICKRMAIL",personName:o[0].getValue("displayname"),personUrl:o[0].getValue("url"),flickrmailUrl:"/mail/"+e.eventDataList[0].id,flickrmailContent:t.StringHelper.stripTags(e.eventDataList[0].subject)}),{headline:i,timestamp:e.timestamp,avatarData:{id:o[0].getValue("id"),type:"person",iconUrl:o[0].getValue("buddyicon").small,url:o[0].getValue("url")}}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},photo_comment_mention:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o,a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_COMMENT_MENTIONED_YOU_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1),commentsUrl:a.getValue("url")+"/#comments"}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENT_MENTIONED_YOU_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),commentUrl:a.getValue("url")+"/#comments",commentContent:t.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},gallery:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o,a=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_ADDED_1_PHOTO_TO_GALLERIES",personName:a[0].getValue("displayname"),personUrl:a[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1)}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_ADDED_1_PHOTO_TO_GALLERY",personName:a[0].getValue("displayname"),personUrl:a[0].getValue("url"),galleryUrl:i.eventDataList[0].gallery.url,galleryTitle:t.StringHelper.stripTags(i.eventDataList[0].gallery.title.content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:a[0].getValue("id"),type:"person",iconUrl:a[0].getValue("buddyicon").small,url:a[0].getValue("url")},photo:{id:i.eventDataList[0].gallery.primaryPhotoId,url:i.eventDataList[0].gallery.url,displayUrl:i.eventDataList[0].gallery.iconurls.medium}}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},gallery_comment:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(i){var o,a=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_COMMENTED_ON_1_GALLERY",personName:a[0].getValue("displayname"),personUrl:a[0].getValue("url"),personCountString:t.IntlNumber.format(i.activityData.countUsers,e.lang,1),galleryUrl:i.activityData.gallery.url,galleryTitle:t.StringHelper.stripTags(i.activityData.gallery.title.content)}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENTED_ON_1_GALLERY",personName:a[0].getValue("displayname"),personUrl:a[0].getValue("url"),galleryUrl:i.activityData.gallery.url,galleryTitle:t.StringHelper.stripTags(i.activityData.gallery.title.content),commentUrl:"/TMPGalleryUrl/#comment"+i.eventDataList[0].commentid,commentContent:t.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:a[0].getValue("id"),type:"person",iconUrl:a[0].getValue("buddyicon").small,url:a[0].getValue("url")},photo:{id:i.activityData.gallery.primaryPhotoId,url:i.activityData.gallery.url,displayUrl:i.activityData.gallery.iconurls.medium}}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},share:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(t){var e,i=t.activityEntityModels.photo,o=t.userModels;return e=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_SHARED_1_PHOTO",personName:o[0].getValue("displayname"),personUrl:o[0].getValue("url"),photoTitle:i.getValue("title"),photoUrl:i.getValue("url")}),{headline:e,timestamp:t.timestamp,avatarData:{id:o[0].getValue("id"),type:"person",iconUrl:o[0].getValue("buddyicon").small,url:o[0].getValue("url")},photo:l(i)}},loadContextMenuConfig:function(t){return g.person.loadConfig({item:t,personModel:t.userModels[0]})}},photo_accepted:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(t){var e,i;if(t.activityData.photo){i=t.eventEntityModelsList[0].group;var o=t.activityEntityModels.photo;return e=n.intlHTMLMessage({intlName:"notifications.NOTIF_GROUP_ADMIN_APPROVED_1_PHOTO",groupName:i.getValue("title"),groupUrl:i.getValue("url")}),{headline:e,timestamp:t.timestamp,subtitle:i.getValue("title"),subtitleUrl:i.getValue("url"),avatarData:{id:i.getValue("id"),type:"group",iconUrl:i.getValue("bestIconURL"),url:i.getValue("url")},photo:l(o)}}i=t.activityEntityModels.group;var a=t.eventEntityModelsList.map(function(t){return t.photo});return e=n.intlHTMLMessage({intlName:"notifications.NOTIF_GROUP_ADMIN_APPROVED_X_PHOTOS",groupName:i.getValue("title"),groupUrl:i.getValue("url"),photoCountString:t.activityData.countEvents}),{headline:e,timestamp:t.timestamp,subtitle:i.getValue("title"),subtitleUrl:i.getValue("url"),avatarData:{id:i.getValue("id"),type:"group",iconUrl:i.getValue("bestIconURL"),url:i.getValue("url")},photos:a.map(function(t){return l(t)}).slice(0,12),hasMultiplePhotos:!0}},loadContextMenuConfig:function(t){var e=t.activityData.photo?t.eventEntityModelsList[0].group:t.activityEntityModels.group;return g.group.loadConfig({item:t,groupId:e.getValue("id")})}},photo_declined:{extractEntitiesFromResponse:function(t){return s(t)},setupView:function(t){return e.getView("base-notification-item-view",{activityItem:t}).then(function(t){return t.initialize()})},constructTemplateConfig:function(t){var e,i;if(t.activityData.photo){i=t.eventEntityModelsList[0].group;var o=t.activityEntityModels.photo;return e=n.intlHTMLMessage({intlName:"notifications.NOTIF_GROUP_ADMIN_REJECTED_1_PHOTO",groupName:i.getValue("title"),groupUrl:i.getValue("url")}),{headline:e,timestamp:t.timestamp,subtitle:i.getValue("title"),subtitleUrl:i.getValue("url"),avatarData:{id:i.getValue("id"),type:"group",iconUrl:i.getValue("bestIconURL"),url:i.getValue("url")},photo:l(o)}}i=t.activityEntityModels.group;var a=t.eventEntityModelsList.map(function(t){return t.photo});return e=n.intlHTMLMessage({intlName:"notifications.NOTIF_GROUP_ADMIN_REJECTED_X_PHOTOS",groupName:i.getValue("title"),groupUrl:i.getValue("url"),photoCountString:t.activityData.countEvents}),{headline:e,timestamp:t.timestamp,subtitle:i.getValue("title"),subtitleUrl:i.getValue("url"),avatarData:{id:i.getValue("id"),type:"group",iconUrl:i.getValue("bestIconURL"),url:i.getValue("url")},photos:a.map(function(t){return l(t)}).slice(0,12),hasMultiplePhotos:!0}},loadContextMenuConfig:function(t){var e=t.activityData.photo?t.eventEntityModelsList[0].group:t.activityEntityModels.group;return g.group.loadConfig({item:t,groupId:e.getValue("id")})}},photo_mention:{},group_blast:{},upload:{}};var f={extractEntitiesFromResponse:function(e){try{return c[e.type].extractEntitiesFromResponse(e)}catch(e){return t.Promise.resolve({})}},setupView:function(t){var e=t.type;try{return c[e].setupView(t)}catch(t){return}},getTemplateHtml:function(t){var e,i=t.type;try{return e=c[i].constructTemplateConfig(t),d.getTemplate(o[i])(e)}catch(t){return""}},loadContextMenuConfig:function(t){var e=t.type;return c[e].loadContextMenuConfig(t)},getContextMenuConfig:function(t){return g[t.contextMenuType].getConfig(t)},convertNotificationModel:function(t){return{id:t.getValue("id"),seen:t.getValue("isSeen"),isMuted:t.getValue("isMuted"),type:t.getValue("type"),timestamp:t.getValue("timestamp"),model:t,activityData:t.getValue("activityData"),eventDataList:t.getValue("eventDataList"),userModels:t.getValue("userModels"),activityEntityModels:t.getValue("activityEntityModels"),eventEntityModelsList:t.getValue("eventEntityModelsList")}}};return t.augment(f,t.EventTarget),f}},"@VERSION@",{requires:["event-custom","template-lib-helper","api-helper","intl-number","string-helper","group-status-helper","base-notification-item-view","follow-notification-item-view","testimonial-notification-item-view","group-invite-notification-item-view","hermes-template-notification-core","hermes-template-notif-item-fave","hermes-template-notif-item-comment","hermes-template-notif-item-reply-reply","hermes-template-notif-item-group-topic-new","hermes-template-notif-item-contacted","hermes-template-notif-item-group-invite","hermes-template-notif-item-note","hermes-template-notif-item-tag","hermes-template-notif-item-people","hermes-template-notif-item-testimonial","hermes-template-notif-item-group-user-invite","hermes-template-notif-item-flickrmail","hermes-template-notif-item-photo-comment-mention","hermes-template-notif-item-gallery","hermes-template-notif-item-gallery-comment","hermes-template-notif-item-share","hermes-template-notif-item-photo-accepted","hermes-template-notif-item-photo-declined","hermes-template-notif-item-photo-mention","hermes-template-notif-item-group-blast","hermes-template-notif-item-upload"],langBundles:["common","relative-dates","notifications","profile","photo-card","header"]});YUI.add("hermes-lang-profile",function(e,o){e.Intl.add("hermes/profile","en-US",{MEMBER_DESCRIPTION:["Description"],MEMBER_INFO:["Member info"],EMPTY_DESCRIPTION:["Write a little about yourself"],ABOUT_USERNAME:["About ","${username}"],MOST_POPULAR_PHOTOS:["Most popular photos"],MOST_POPULAR_PHOTOS_EMPTY_TITLE:["Your most popular photos will appear here."],MOST_POPULAR_PHOTOS_EMPTY_TEXT:["Set your photos to public for more faves, comments and views."],MOST_POPULAR_PHOTOS_EMPTY_TEXT_2:["For even more exposure, add them to Groups"],HAS_NO_PUBLIC_PHOTOS_YET:["${username}"," hasn't made any photos public yet."],MOST_POPULAR_PHOTOS_GO_TO_CR:["Go to Camera Roll"],TESTIMONIALS:["Testimonials"],PHOTOS_OF:["Photos of ","${username}"],READ_MORE:["Read more"],READ_LESS:["Read less"],EDIT_DESCRIPTION:["Edit description"],EDIT_INFOS:["Edit your profile information"],EDIT_SHOWCASE:["Edit your showcase"],CHANGE_SHOWCASE_PHOTOS:["Change your showcase photos"],SHOWCASE_FULL:["Your showcase is full! Change photos"],SHOWCASE_ALMOST_FULL:["One photo to go, choose well!"],ADD_PHOTOS:["Add photos"],VIEW_ALL:["View all"],THIS_YOUR_SHOWCASE:["This is your showcase."],SHOW_OFF_YOUR_PHOTOS:["Show off up to ","${limit}"," of your photos."],GET_STARTED:["Get started"],CHOOSE_UP_TO_PHOTOS:[{type:"plural",valueName:"limit",options:{one:"Choose up to ${#} more photo",other:"Choose up to ${#} more photos"}}],SELECT_PHOTOS:["Select photos"],SHOWCASE_ALREADY_THERE:["This photo is already in your showcase."],SHOWCASE_ERR:["An error has occurred. Please refresh the page."],BIO_JOINED:["Joined"],BIO_OCCUPATION:["Occupation"],BIO_HOMETOWN:["Hometown"],BIO_CURRENT_CITY:["Current city"],BIO_COUNTRY:["Country"],BIO_WEBSITE:["Website"],BIO_EMAIL:["Email"],BIO_FACEBOOK:["Facebook"],BIO_TWITTER:["Twitter"],BIO_INSTAGRAM:["Instagram"],BIO_PINTEREST:["Pinterest"],BIO_TUMBLR:["Tumblr"],BIO_RELATIONSHIP:["Relationship"],COUNTS_GROUPS:[{type:"plural",valueName:"groupsCount",options:{one:"group",other:"groups"}}],COUNTS_GEOTAGGED:[{type:"plural",valueName:"geoCount",options:{one:"geotagged photo",other:"geotagged photos"}}],COUNTS_GEOTAGS:[{type:"plural",valueName:"geoCount",options:{one:"geotag",other:"geotags"}}],COUNTS_FAVORITES:[{type:"plural",valueName:"favesCount",options:{one:"fave",other:"faves"}}],COUNTS_TAGS:[{type:"plural",valueName:"tagsCount",options:{one:"tag",other:"tags"}}],COUNT_VIEWS:[{type:"plural",valueName:"viewsCount",options:{one:"view",other:"views"}}],BLOCK_USER:["Block user"],FILTER_FAVES:["Most faved"],FILTER_VIEWS:["Most viewed"],FILTER_COMMENTS:["Most commented"],FILTER_INTERESTING:["Most interesting"],AWESOME:["Awesome!"],REFRESH_NOW:["Refresh now to see your showcase."],TOO_MANY_PHOTOS:["Sorry, you can't add more than ","${limit}"," photos to your showcase."],PROFILE_SHARE_FEEDBACK:['This new Flickr Profile is only visible to Alpha Group members. Please share your feedback <a href="',"${url}",'">here</a>.'],PROFILE_SHARE_FEEDBACK_ONBOARDING:['Profiles got a makeover. We really want to know what you think. <a href="',"${url}",'">Send us some feedback!</a>'],PROFILE_CHECK_OUT:['Profiles got a makeover — check out your <a href="',"${urlAbout}",'">new About page</a>! Then, <a href="',"${urlFeedback}",'" target="_blank">let us know what you think</a>!'],PROFILE_PHOTO_NOT_PUBLIC:["This photo does not seem to be public."],PROFILE_SAVED_MAGICALLY:["Changes are saved automagically!"],PROFILE_SAVED_AUTO:["Changes are saved automatically!"],SAVING:["Saving"],PLACEHOLDER_SOCIAL:["Your username or profile link"],EVERYONE:["Everyone"],ANY_FLICKR_MEMBER:["Any Flickr Member"],PEOPLE_I_FOLLOW:["People I follow"],FRIENDS_AND_FAMILY:["Friends and family"],ONLY_ME:["Only me"],USER_FOLLOWS_YOU:["${username}"," is following you."],USER_IS_FAMILY:["${username}"," counts you as Family."],USER_IS_FRIEND:["${username}"," counts you as a Friend."],USER_IS_FRIEND_FAMILY:["${username}"," counts you as Friend & Family."],TESTIM_PENDING:["Pending"],TESTIM_EMPTY_SELF:["Nobody has added a testimonial for you yet."],TESTIM_EMPTY_SOMEONE:["Nobody has added a testimonial yet."],TESTIM_EMPTY:["Have something nice to say about ","${username}","?"],TESTIM_WRITE:["Write a testimonial"],TESTIM_POST:["Post"],TESTIM_SHOW_MORE:["View more"],TESTIM_APPROVE:["Approve"],TESTIM_REJECT:["Reject"],TESTIM_SENT_APPROVAL:["Your testimonial will be sent to ","${username}"," for approval."],TESTIM_SENT_APPROVAL_SHOWN:["Your testimonial will be shown once ","${username}"," approves it."],TESTIM_GREAT_TITLE:["Great!"],TESTIM_DELETE_CONFIRM:["Delete this post?"],TESTIM_DELETE_TEXT:["You cannot reverse this action. Are you sure you want to permanently delete this post?"],TESTIM_EDIT_CONFIRM_TITLE:["Edit this post?"],TESTIM_EDIT_CONFIRM_TEXT:["If you choose to edit this post, it will be sent back to the person you're writing about for approval."],TESTIM_EDIT_VISIT_PROFILE:["You can edit this testimonial on ","${username}","'s profile."],TESTIM_EDIT_VISIT_PROFILE_TEXT:["If you choose to edit this post, it will be sent back to ","${username}"," for their approval."],TESTIM_EDIT_VISIT_PROFILE_GO:["Go to profile"],YOUR_SELECTION_HEADER:["Your Selection"],NO_PHOTOS_SELECTED:["No photos selected."],SELECTED:["Selected"],PROFILE_SHOWCASE_TITLE:["Profile showcase"],PROFILE_SHOWCASE_TITLE_SHORT:["Showcase"],PROFILE_WHATS_NEW:["What’s new?"],PROFILE_BIO_TOOLTIP:["Add a few more details about yourself to complete your profile."],PROFILE_POPULAR_TOOLTIP:["These are your most popular photos on Flickr. You can choose to have this section visible to everyone or only to you."],PROFILE_PHOTOSOF_TOOLTIP:["You can tag and untag yourself in photos by visiting the “People in photo” section on the photo page."],PROFILE_PHOTOSOF_MODAL_TITLE:["Untag yourself from this photo ?"],PROFILE_CHECK_IT_OUT:["Check it out"],PROFILE_GOT_IT:["Got it, thanks"],TESTIM_FILTER_RECEIVED:["Received"],TESTIM_FILTER_GIVEN:["Given"],TESTIM_NOTHING_TO_SHOW:["Nothing to show."],TESTIM_POSTED_ON:[{type:"date",valueName:"intlDate",format:"long"}],TESTIM_AUTHOR_SAYS:['<a href="',"${url}",'" class="username">',"${displayname}","</a> says:"],TESTIM_AUTHOR_FOR:['For <a href="',"${url}",'" class="username">',"${displayname}","</a>:"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-photo-card",function(e,o){e.Intl.add("hermes/photo-card","en-US",{SHARE_THIS_PHOTO:["Share this photo"],SEND_A_MESSAGE:["Send a message"],FOLLOW_USER:['Follow <span class="username-text">',"${username}","</span>"],UNFOLLOW_USER:['Unfollow <span class="username-text">',"${username}","</span>"],BLOCK_USER:['Block <span class="username-text">',"${username}","</span>"],UNBLOCK_USER:['Unblock <span class="username-text">',"${username}","</span>"],SHARE_PHOTOSTREAM:["Share photostream"],SHARE_GROUP:["Share group"],JOIN_GROUP:["Join group"],LEAVE_GROUP:["Leave group"],BLOCK_USER_QUESTION:['Block <span class="username-text">',"${username}","</span>?"],BLOCK_CONFIRM_MESSAGE:["They will not be able to follow you, interact with your photos or videos, or send you FlickrMail. Any comments or faves on your content from them will be deleted, and your content will be removed from their galleries."],BLOCK_CONFIRM_MESSAGE_NOTE:["Note: While the block itself will occur immediately, <b>removal of comments and favorites can take up to several hours</b> (though hopefully not that long!)."],HIDE_FROM_ACTIVITY_FEED:["Hide from activity feed"],SHOW_IN_ACTIVITY_FEED:["Show in activity feed"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-header",function(o,e){o.Intl.add("hermes/header","en-US",{EDIT_COVER_PHOTO:["Edit cover photo"],PHOTOSTREAM:["Photostream"],ALBUMS:["Albums"],FAVORITES:["Favorites"],CREATIONS:["Creations"],PHOTO_BOOKS:["Photo Books"],EDIT:["Edit"],PUBLIC:["Public"],ALL:["All"],CHANGE_YOUR_BUDDY_ICON:["Change your Buddy Icon"],CHANGE_YOUR_GROUP_ICON:["Change your group icon"],MEMBER_SINCE:["Member Since"],GROUP_SINCE:["Group Since"],MDY_DATE:[{type:"date",valueName:"mdyDate",format:"medium"}],PHOTOS:["Photos"],VIEWS:["Views"],VIEW_ALL_ALBUMS:["View all albums"],SEND_FLICKR_MAIL:["Send FlickrMail"],BLOCK:["Block"],USERS_GOD_PAGE:["User's God Page"],GROUP_GOD_PAGE:["God"],ADMINISTRATION:["Administration"],DISCUSSIONS:["Discussions"],MEMBERS:["Members"],MAP:["Map"],ABOUT:["About"],INVITE:["Invite Friends"],OVERVIEW:["Overview"],FULLSCREEN:["Fullscreen"],SHARE_THIS_PAGE:["Share this page"],COMMENT:["Comment"],MORE_ACTIONS:["More actions"],THUMBNAIL_VIEW:["Thumbnail view"],GROUP_LIST:["Group List"],CREATE_GROUP:["Create Group"],COVER_PHOTO_CHOOSE:["Choose Cover Photo"],COVER_PHOTO_UPLOAD:["Upload a photo"],COVER_PHOTO_SET_POSITION:["Drag to set position!"],COVER_PHOTO_SAVE:["Save"],COVER_PHOTO_CANCEL:["Cancel"],COVER_PHOTO_LIST_ERROR:["We're having some trouble listing your photos. Try again in a few seconds."],COVER_PHOTO_SELECT_ERROR:["We're having some trouble selecting that photo. Try again in a few seconds."],COVER_PHOTO_POSITION_ERROR:["We're having some trouble positioning that photo. Try again in a few seconds."],COVER_PHOTO_LOW_RESOLUTION:["This photo is small and may not look great as a coverphoto."],COVER_PHOTO_NO_PHOTOS:["Uh oh! No photos here.<br/>What? Do we have to take them for you, too?"],GROUPS_HEADER:["Your Groups"],GROUP_JOIN:["Join Group"],GROUP_JOINED:["Joined"],GROUP_JOIN_REQUESTED:["Join Requested"],GROUP_LEAVE_GROUP:["Leave Group"],GROUPS_OPT_OUT_MESSAGE:["You are viewing the beta version of our new groups experience. Click here to return to the old version."],GROUPS_OPT_IN_MESSAGE:["Go back to the beta groups experience."],STEAMPUNK_OCTOPUS:["Steampunk Octopus"],FOLLOWERS:[{type:"plural",valueName:"count",options:{one:"${#} Follower",other:"${#} Followers"}}],FOLLOWING:[{type:"plural",valueName:"count",options:{one:"${#} Following",other:"${#} Following"}}],FOLLOWER_COUNT:[{type:"plural",valueName:"count",options:{one:["${countString}"," Follower"],other:["${countString}"," Followers"]}}],FOLLOWING_COUNT:[{type:"plural",valueName:"count",options:{one:["${countString}"," Following"],other:["${countString}"," Following"]}}],FOLLOWERS_SIMPLE:["Followers"],FOLLOWING_SIMPLE:["Following"],JOINED_YEAR:["Joined ","${year}"],COUNT_PHOTOS:[{type:"plural",valueName:"count",options:{one:"${#} Photo",other:"${#} Photos"}}],GUESTPASS_HISTORY:["Sharing history"],POSITION_IMAGE:["Position your image"],MIN_ZOOM:["You can't zoom out anymore for this image"],GIFT_PRO:["Gift Pro"],GIVE_PRO:["Give Pro"]})},"@VERSION@",{requires:["intl"]});YUI.add("notifications-panel-view",function(t,i){require("hermes-core/flog")(i);t.namespace("Views")[this.name]=t.Base.create("notifications-panel-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.selectedTabId="main"},subviewConfig:{"notifications-list-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){return t.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("notifications-panel",{})},activate:function(){var t=this.get("container");return this.tabNodes={},this.listView=this.subviews["notifications-list-view"],this.tabContainer=t.one(".tabs"),this.tabNodes.main=this.tabContainer.one('.tab[data-tab-id="main"'),this.tabNodes.admin=this.tabContainer.one('.tab[data-tab-id="admin"'),this.registerEventHandler(this.tabContainer.delegate("click",this.handleTabClick.bind(this),".tab")),this},handleTabClick:function(t){var i=t.target.getAttribute("data-tab-id");this.switchTabs(i)},switchTabs:function(t){t&&this.tabNodes[t]&&t!==this.selectedTabId&&(this.selectedTabId=t,Object.values(this.tabNodes).forEach(function(t){t.removeClass("selected")}),this.tabNodes[t].addClass("selected"),this.loadTab(t))},loadTab:function(t){this.listView.reload()}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications-panel","notifications-helper"],langBundles:["common","notifications","relative-dates"]});YUI.add("notifications-menu-view",function(t){"use strict";t.namespace("Views")[this.name]=t.Base.create("notifications-menu-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.pollingFailed=!1,this.shouldFetchNotifs=!0,this.notifFilter=["group_topic_new","user_gallery_comment"].join(","),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("notifications-menu"),this},loadState:function(){var e=this,n=this.appContext.getViewer();return this.appContext.getModel("person-notifications-models",n.nsid).then(function(i){if(e.set("personNotificationsModel",i),Date.now()-i.getValue("unseenLastFetchedTimestamp")>t.config.flickr.notifications.loading_count_refetch_delay)return i.remoteReadUnseenNotificationCount({id:n.nsid,filter:e.notifFilter},e.appContext).then(null,function(t){e.pollingFailed=!0})})},buildContainer:function(){var t=this.formatCount99(this.get("personNotificationsModel").getValue("unseenNotificationCount"));return this.setContainerWithTemplate("notifications-menu",{unseenNotificationCount:t}),this},activate:function(){var e=this,n=e.get("personNotificationsModel");e.unseenBadge=e.get("container").one(".c-notification-unseencount"),e.unseenCount=0,e.notifIcon=e.get("container").one(".c-notification-icon"),0===n.getValue("unseenNotificationCount")?e.unseenBadge.addClass("hidden"):e.unseenBadge.removeClass("hidden"),t.on("notifications:closeNotificationsMenuClicked",function(t){e.droparound.close()}),this.registerEventHandler(this.get("container").on("click",e.openMenu.bind(e))),this.registerEventHandler(this.get("container").on("key",e.keyboardToggleMenu.bind(e),"down:13,32")),this.registerEventHandler(this.get("container").on("key",e.enterMenu.bind(e),"down:9,40")),e.pollForUnseenNotifs()},pollForUnseenNotifs:function(){this.pollIntervalId=setInterval(this.readUnseenNotifs.bind(this),t.config.flickr.notifications.polling_delay)},readUnseenNotifs:function(){var e=this,n=this.appContext.getViewer();e.get("personNotificationsModel").remoteReadUnseenNotificationCount({id:n.nsid,filter:e.notifFilter},e.appContext).then(function(t){e.shouldFetchNotifs=!0,t!==e.unseenCount&&(e.unseenCount=t,0!==t?(e.unseenBadge.removeClass("hidden"),e.unseenBadge.set("text",e.formatCount99(t))):e.unseenBadge.addClass("hidden"))},function(n){clearInterval(e.pollIntervalId),e.pollingFailed||(e.pollingFailedTimeoutId=setTimeout(e.pollForUnseenNotifs.bind(e),t.config.flickr.notifications.polling_failure_timeout)),e.pollingFailed=!0})},openMenu:function(){this.revealNotifications()},keyboardToggleMenu:function(t){t.preventDefault(),!this.droparound||this.droparound.isClosed?this.revealNotifications():this.droparound.close()},enterMenu:function(t){var e=t.keyCode;if(9===e&&!t.shiftKey&&"true"===t.target.getAttribute("aria-expanded")||40===e){t.preventDefault();var n=this.droparound.get("container").one("div.notifs-droparound");if(n){var i=n.one("a.mail-icon");this.registerEventHandler(i.on("key",this.enterNotificationsList.bind(this),"down:9,40")),i.focus()}}},enterNotificationsList:function(t){var e=t.keyCode;(9===e&&!t.shiftKey||40===e)&&(t.preventDefault(),this.droparound.get("subview").findFocus.call(this,this.droparound.get("container").one("div.notifs-droparound").one("ul").one("li:not(.hidden)")))},revealNotifications:function(){var e,n=this.appContext.viewportData.getWidth(),i=this.appContext.viewportData.getHeight(),o=n>700?60:67,s=n>700?"":n-2+"px",a=i>1e3?"800px":i-200+"px";this.appContext.flipper.isFlipped("enable-notifications-2020")?(e=new t.Views["notifications-panel-view"]({appContext:this.appContext}),this.droparound=new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,anchorOffsetVertical:-4,showDropArrow:!0,contentPadding:0,anchorElement:this.get("container").one(".c-notification-icon"),subview:e,observePageResize:!0,positionFixed:!0,autoSizeToContent:!0,preventPageScrollOnScroll:!0}),this.droparound.show(),this.unseenBadge.addClass("hidden"),this.shouldFetchNotifs=!1):((e=new t.Views["notifications-view"]({appContext:this.appContext,width:s,listHeight:a,shouldFetchNotifs:this.shouldFetchNotifs,notifFilter:this.notifFilter})).appContext=this.appContext,this.droparound=new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,anchorOffsetVertical:-4,anchorOffsetHorizontal:o,mirrorArrowAdjustment:o-11,showDropArrow:!0,contentPadding:0,classList:"notifs-droparound no-border big-shadow",anchorElement:this.get("container").one(".c-notification-icon"),subview:e,observePageResize:!0,positionFixed:!0,autoSizeToContent:!0,preventPageScrollOnScroll:!0}),this.droparound.show(),this.unseenBadge.addClass("hidden"),this.shouldFetchNotifs=!1)},formatCount99:function(t){return t>=100?"99+":t},destructor:function(){clearInterval(this.pollIntervalId),clearTimeout(this.pollingFailedTimeoutId)}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications-menu","fluid-droparound-view","notifications-view","notifications-panel-view"],langBundles:["notifications","common"]});YUI.add("hermes-template-person-card",function(a,n){var l=a.Template.Handlebars.revive({1:function(a,n,l,e,t){var s;return"\t\t\t\t\t"+a.escapeExpression(a.lambda(null!=(s=null!=n?n.person:n)?s.realname:s,n))+"\n\t\t\t\t\t"+(null!=(s=l.if.call(null!=n?n:{},null!=n?n.personLocation:n,{name:"if",hash:{},fn:a.program(2,t,0),inverse:a.noop,data:t}))?s:"")+"\n"},2:function(a,n,l,e,t){return" - "},4:function(a,n,l,e,t){var s;return null!=(s=l.each.call(null!=n?n:{},null!=n?n.photostream:n,{name:"each",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?s:""},5:function(a,n,l,e,t){var s;return null!=(s=l.if.call(null!=n?n:{},null!=n?n.needsInterstitial:n,{name:"if",hash:{},fn:a.program(6,t,0),inverse:a.program(8,t,0),data:t}))?s:""},6:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression,c=a.lambda;return'\t\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=l.url||(null!=n?n.url:n))?r:o)?r.call(i,{name:"url",hash:{},data:t}):r)+'" title="'+u("function"==typeof(r=null!=(r=l.title||(null!=n?n.title:n))?r:o)?r.call(i,{name:"title",hash:{},data:t}):r)+'" width="'+u(c(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.width:s,n))+'" height="'+u(c(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.height:s,n))+'" style="background: url(https://combo.staticflickr.com/pw/images/spaceball.gif);" data-track="personCardRecentPhotosClick"></a>\n'},8:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression;return'\t\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=l.url||(null!=n?n.url:n))?r:o)?r.call(i,{name:"url",hash:{},data:t}):r)+'" title="'+u("function"==typeof(r=null!=(r=l.title||(null!=n?n.title:n))?r:o)?r.call(i,{name:"title",hash:{},data:t}):r)+'" style="background: url('+u(a.lambda(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.displayUrl:s,n))+');" data-track="personCardRecentPhotosClick"></a>\n'},10:function(a,n,l,e,t){return'\t\t\t<span class="tertiary">'+a.escapeExpression((l.intlMessage||n&&n.intlMessage||l.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"person.NO_PHOTOS"},data:t}))+"</span>\n"},compiler:[7,">= 4.0.0"],main:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression,c=a.lambda;return'\n<div>\n\t<section>\n\t\t<div class="follow-subview">'+u((l.outlet||n&&n.outlet||o).call(i,null!=n?n["follow-view"]:n,{name:"outlet",hash:{},data:t}))+'</div>\n\n\t\t<div class="attribution">\n\t\t\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.photostream:s,n))+'" data-track="personCardAttributionNameClick">\n\t\t\t\t<h3 class="fade-out">'+u(c(null!=(s=null!=n?n.person:n)?s.username:s,n))+'</h3>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="info">\n\t\t\t<span class="secondary realname fade-out">\n'+(null!=(s=l.if.call(i,null!=(s=null!=n?n.person:n)?s.realname:s,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?s:"")+"\t\t\t\t"+u("function"==typeof(r=null!=(r=l.personLocation||(null!=n?n.personLocation:n))?r:o)?r.call(i,{name:"personLocation",hash:{},data:t}):r)+'\n\t\t\t</span>\n\t\t</div>\n\n\t\t<div class="recent-photos">\n'+(null!=(s=l.if.call(i,null!=n?n.photostream:n,{name:"if",hash:{},fn:a.program(4,t,0),inverse:a.program(10,t,0),data:t}))?s:"")+'\t\t</div>\n\t</section>\n</div>\n\n<div class="links secondary">\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.sendFlickrMail:s,n))+'" data-track="personCardMessageClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.MESSAGE"},data:t}))+'</a>\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.albums:s,n))+'" data-track="personCardAlbumsClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.ALBUMS"},data:t}))+'</a>\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.favorites:s,n))+'" data-track="personCardFavesClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.FAVES"},data:t}))+'</a>\n\t<a class="align-right" href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.profile:s,n))+'" data-track="personCardProfileClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:t}))+"</a>\n</div>\n"},useData:!0}),e={};a.Array.each([],function(n){var l=a.Template.get("hermes/"+n);l&&(e[n]=l)}),a.Template.register("hermes/person-card",function(n,t){return t=t||{},t.partials=t.partials?a.merge(e,t.partials):e,l(n,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});